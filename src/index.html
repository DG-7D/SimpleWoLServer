<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <title>SimpleWoLServer</title>
        <link rel="stylesheet" href="/style.css">
    </head>

    <body>
        <h1>SimpleWoLServer</h1>
        <table>
            <thead>
                <th></th>
                <th>Machine</th>
                <th>Wake</th>
                <th>Service</th>
            </thead>
            <tbody>
                <!-- generate -->
            </tbody>
        </table>
    </body>

    <script defer>
        const pingInterval = 5000;

        for (const element of document.getElementsByClassName("ping")) {
            const hostname = element.dataset.ping;
            if (hostname) {
                setInterval(
                    () => {
                        try {
                            ping(hostname)
                                .then(responsed => element.textContent = responsed ? "💡" : "💤");
                        } catch {
                            element.textContent = "❗";
                        }
                    },
                    pingInterval
                )
            }
        }

        for (const button of document.getElementsByClassName("wake")) {
            button.addEventListener("click", (event) => {
                event.target.disabled = true;
                wake(event.target.dataset.macAddress)
                    .then(setTimeout(() => event.target.disabled = false, 1000));
            })
        }

        async function wake(macAddress) {
            return fetch(
                "/wake",
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        macAddress: macAddress,
                    }),
                }
            )
        }
        async function ping(hostname) {
            const urlSearchParams = new URLSearchParams({ hostname: hostname });
            const url = `/ping?${urlSearchParams.toString()}`;
            return await fetch(url)
                .then(response => response.json())
                .then(json => json.responsed);
        }
    </script>

</html>